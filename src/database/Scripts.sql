-- CREATE DATABASE `dncommerce` DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci
-- ;

USE dncommerce
;

/* Logico_DNCommerce: */
ALTER TABLE TBL_PRODUTO DROP FOREIGN KEY FK_PRODUTO_MARCA; 
ALTER TABLE TBL_PEDIDO DROP FOREIGN KEY FK_PEDIDO_CLIENTE; 
ALTER TABLE TBL_PEDIDO DROP FOREIGN KEY FK_PEDIDO_PRODUTO;
ALTER TABLE TBL_VENDA DROP FOREIGN KEY FK_VENDA_FORMA_PAGTO;
ALTER TABLE TBL_VENDA DROP FOREIGN KEY FK_VENDA_PEDIDO; 
ALTER TABLE TBL_ESTOQUE DROP FOREIGN KEY FK_ESTOQUE_PRODUTO; 
ALTER TABLE TBL_ESTOQUE DROP FOREIGN KEY FK_ESTOQUE_ARMAZEM;

DROP TABLE TBL_CLIENTE;
DROP TABLE TBL_PRODUTO;
DROP TABLE TBL_PEDIDO;
DROP TABLE TBL_VENDA;
DROP TABLE TBL_MARCA;
DROP TABLE TBL_ESTOQUE;
DROP TABLE TBL_ARMAZEM;
DROP TABLE TBL_FORMA_PAGTO;

CREATE TABLE TBL_CLIENTE (
    ID INTEGER AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(300) NOT NULL,
    CPF VARCHAR(11) UNIQUE NOT NULL,
    TELEFONE VARCHAR(45),
    EMAIL VARCHAR(150) NOT NULL,
    DATA_NASCIMENTO DATE NOT NULL,
    RUA VARCHAR(300) NOT NULL,
    BAIRRO VARCHAR(300) NOT NULL,
    CIDADE VARCHAR(300) NOT NULL,
    UF VARCHAR(10) NOT NULL,
    CEP CHAR(8) NOT NULL
);

CREATE TABLE TBL_PRODUTO (
    ID INTEGER AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(300) NOT NULL,
    PRECO DECIMAL(13,2) NOT NULL,
    PESO_LIQUIDO DECIMAL(13,2) NOT NULL,
    UNID_MEDIDA_PESO_LIQ VARCHAR(10) NOT NULL,
    MARCA_ID INTEGER NOT NULL,
    CONSTRAINT UNQ_PRODUCT UNIQUE(NOME, PRECO, PESO_LIQUIDO, UNID_MEDIDA_PESO_LIQ, MARCA_ID)
);

CREATE TABLE TBL_PEDIDO (
    ID INTEGER AUTO_INCREMENT,
    QUANTIDADE INTEGER NOT NULL,
    VALOR_TOTAL DECIMAL(13,2) NOT NULL,
    DATA DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CLIENTE_ID INTEGER NOT NULL,
    PRODUTO_ID INTEGER NOT NULL,
    PRIMARY KEY (ID, CLIENTE_ID, PRODUTO_ID)
);
-- DROP TABLE TBL_PEDIDO;

CREATE TABLE TBL_VENDA (
    ID INTEGER AUTO_INCREMENT PRIMARY KEY,
    VALOR_FRETE DECIMAL(13,2) NOT NULL,
    VALOR_TOTAL DECIMAL(13,2) NOT NULL,
    CUPOM VARCHAR(150) NULL,
    DATA DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FORMA_PAGTO_ID INTEGER NOT NULL,
    PEDIDO_ID INTEGER NOT NULL
);
-- DROP TABLE TBL_VENDA;

CREATE TABLE TBL_ESTOQUE (
    PRODUTO_ID INTEGER NOT NULL,
    QUANTIDADE INTEGER NOT NULL,
    ARMAZEM_ID INTEGER NOT NULL DEFAULT 1,
    PRIMARY KEY (PRODUTO_ID, ARMAZEM_ID)
);

CREATE TABLE TBL_MARCA (
    ID INTEGER AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(300) NOT NULL,
    CNPJ CHAR(14) NULL
);

CREATE TABLE TBL_ARMAZEM (
    ID INTEGER AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(300) NOT NULL
);

CREATE TABLE TBL_FORMA_PAGTO (
    ID INTEGER AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(300) NOT NULL
);

ALTER TABLE TBL_PRODUTO ADD CONSTRAINT FK_PRODUTO_MARCA
    FOREIGN KEY (MARCA_ID)
    REFERENCES TBL_MARCA (ID);
 
ALTER TABLE TBL_PEDIDO ADD CONSTRAINT FK_PEDIDO_CLIENTE
    FOREIGN KEY (CLIENTE_ID)
    REFERENCES TBL_CLIENTE (ID);
 
ALTER TABLE TBL_PEDIDO ADD CONSTRAINT FK_PEDIDO_PRODUTO
    FOREIGN KEY (PRODUTO_ID)
    REFERENCES TBL_PRODUTO (ID);
 
ALTER TABLE TBL_VENDA ADD CONSTRAINT FK_VENDA_FORMA_PAGTO
    FOREIGN KEY (FORMA_PAGTO_ID)
    REFERENCES TBL_FORMA_PAGTO (ID);
 
ALTER TABLE TBL_VENDA ADD CONSTRAINT FK_VENDA_PEDIDO
    FOREIGN KEY (PEDIDO_ID)
    REFERENCES TBL_PEDIDO (ID);
 
ALTER TABLE TBL_ESTOQUE ADD CONSTRAINT FK_ESTOQUE_PRODUTO
    FOREIGN KEY (PRODUTO_ID)
    REFERENCES TBL_PRODUTO (ID);
 
ALTER TABLE TBL_ESTOQUE ADD CONSTRAINT FK_ESTOQUE_ARMAZEM
    FOREIGN KEY (ARMAZEM_ID)
    REFERENCES TBL_ARMAZEM (ID);

TRUNCATE TABLE TBL_CLIENTE;
TRUNCATE TABLE TBL_PRODUTO;
TRUNCATE TABLE TBL_PEDIDO;
TRUNCATE TABLE TBL_VENDA;
TRUNCATE TABLE TBL_ESTOQUE;
TRUNCATE TABLE TBL_MARCA;
TRUNCATE TABLE TBL_ARMAZEM;
TRUNCATE TABLE TBL_FORMA_PAGTO;

INSERT INTO `dncommerce`.`tbl_cliente`
(`ID`,
`NOME`,
`CPF`,
`TELEFONE`,
`EMAIL`,
`DATA_NASCIMENTO`,
`RUA`,
`BAIRRO`,
`CIDADE`,
`UF`,
`CEP`)
VALUES
(1,
'THIAGO CALEBE BARBOSA',
'21274830060',
'6837429266',
'thiago.calebe.barbosa@rcstechnology.com.br',
DATE('2006-07-18'),
'Travessa Madureira',
'Recanto dos Buritis',
'Rio Branco',
'AC',
'69907557'),
(2,
'KAUÊ EDSON BRITO',
'57141750851',
'8539955730',
'kaue.edson.brito@serteccontabil.com.br',
DATE('1992-02-19'),
'Rua São Raimundo',
'Cambeba',
'Fortaleza',
'CE',
'60822185'),
(3,
'VALENTINA MALU ROCHA',
'48999564797',
'8128312946',
'valentina-rocha77@lordello.com.br',
DATE('1996-01-14'),
'Avenida Professor José dos Anjos',
'Peixinhos',
'Recife',
'PE',
'52125160');

INSERT INTO `dncommerce`.`tbl_marca`
(`ID`,
`NOME`,
`CNPJ`)
VALUES
(1,
'Monange',
'83972562000124')
,(2,
'Samana',
'63780631000190')
,(3,
'Biomarine',
'14802863000197')
,(4,
'Nivea',
'77363809000102')
;

INSERT INTO `dncommerce`.`tbl_produto`
(`ID`,
`NOME`,
`PRECO`,
`PESO_LIQUIDO`,
`UNID_MEDIDA_PESO_LIQ`,
`MARCA_ID`)
VALUES
(1,
'Desodorante Antitranspirante Aerossol',
14.99,
150,
'ml',
1),
(2,
'Água Micelar Antipoluição',
71.92,
200,
'ml',
2),
(3,
'Protetor Solar Sun Marine FPS 50 Acqua Gel',
111.92,
60,
'g',
3),
(4,
'Sabonete Líquido Creme Care Refil',
7.99,
200,
'ml',
4);

INSERT INTO `dncommerce`.`tbl_pedido`
(`ID`,
`QUANTIDADE`,
`VALOR_TOTAL`,
`DATA`,
`CLIENTE_ID`,
`PRODUTO_ID`)
VALUES
(1,
2,
143.84,
CURRENT_TIMESTAMP,
3,
2),
(2,
1,
14.99,
CURRENT_TIMESTAMP,
1,
1),
(2,
2,
15.98,
CURRENT_TIMESTAMP,
1,
4),
(3,
1,
111.92,
CURRENT_TIMESTAMP,
2,
3)
;

INSERT INTO `dncommerce`.`TBL_FORMA_PAGTO` (ID, NOME) 
VALUES (1, 'BOLETO')
		,(2, 'CARTAO DEBITO')
        ,(3, 'CARTAO CREDITO')
        ,(4, 'PIX')
;

INSERT INTO `dncommerce`.`tbl_venda`
(`ID`,
`VALOR_FRETE`,
`VALOR_TOTAL`,
`CUPOM`,
`DATA`,
`FORMA_PAGTO_ID`,
`PEDIDO_ID`)
VALUES
(1,
9.87,
153.71,
'PRIMEIRACOMPRA',
CURRENT_TIMESTAMP,
3,
1),
(2,
11.25,
42.22,
NULL,
CURRENT_TIMESTAMP,
4,
2),
(3,
0,
111.92,
'FRETEGRATIS',
CURRENT_TIMESTAMP,
1,
3);

INSERT INTO `dncommerce`.`tbl_armazem`
(`ID`,
`NOME`)
VALUES
(1,
'DEPOSITO CENTRAL - MATRIZ');

INSERT INTO `dncommerce`.`tbl_estoque`
(`PRODUTO_ID`,
`QUANTIDADE`,
`ARMAZEM_ID`)
VALUES
(1,
80,
1),
(2,
5,
1),
(3,
1,
1);

SELECT * FROM TBL_CLIENTE;
SELECT * FROM TBL_PRODUTO order by ID;
SELECT * FROM TBL_PEDIDO;
SELECT * FROM TBL_VENDA;
SELECT * FROM TBL_ESTOQUE;
SELECT * FROM TBL_MARCA;
SELECT * FROM TBL_ARMAZEM;
SELECT * FROM TBL_FORMA_PAGTO;

SELECT SUM(VALOR_TOTAL) AS VALOR_TOTAL 
FROM TBL_PEDIDO
WHERE ID = 2
;

SELECT * FROM TBL_VENDA;